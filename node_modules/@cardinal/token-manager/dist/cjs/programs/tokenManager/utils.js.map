{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/programs/tokenManager/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import type { AccountData } from \"@cardinal/common\";\nimport {\n  decodeIdlAccount,\n  findMintEditionId,\n  findMintMetadataId,\n  METADATA_PROGRAM_ID,\n  withFindOrInitAssociatedTokenAccount,\n} from \"@cardinal/common\";\nimport {\n  PREFIX as TOKEN_AUTH_RULESET_PREFIX,\n  PROGRAM_ID as TOKEN_AUTH_RULES_ID,\n} from \"@metaplex-foundation/mpl-token-auth-rules\";\nimport {\n  Metadata,\n  TokenStandard,\n} from \"@metaplex-foundation/mpl-token-metadata\";\nimport type { Wallet } from \"@project-serum/anchor/dist/cjs/provider\";\nimport {\n  ASSOCIATED_TOKEN_PROGRAM_ID,\n  getAccount,\n  getAssociatedTokenAddressSync,\n} from \"@solana/spl-token\";\nimport type { AccountMeta, Connection } from \"@solana/web3.js\";\nimport {\n  PublicKey,\n  SystemProgram,\n  SYSVAR_INSTRUCTIONS_PUBKEY,\n  Transaction,\n} from \"@solana/web3.js\";\n\nimport type { CardinalTokenManager } from \"../../idl/cardinal_token_manager\";\nimport type { TokenManagerData } from \".\";\nimport {\n  CRANK_KEY,\n  InvalidationType,\n  TOKEN_MANAGER_IDL,\n  TokenManagerKind,\n  TokenManagerState,\n} from \".\";\nimport {\n  findMintManagerId,\n  findTokenManagerAddress,\n  findTransferReceiptId,\n} from \"./pda\";\n\nexport const getRemainingAccountsForKind = (\n  mintId: PublicKey,\n  tokenManagerKind: TokenManagerKind\n): AccountMeta[] => {\n  if (\n    tokenManagerKind === TokenManagerKind.Managed ||\n    tokenManagerKind === TokenManagerKind.Permissioned\n  ) {\n    return [\n      {\n        pubkey: findMintManagerId(mintId),\n        isSigner: false,\n        isWritable: true,\n      },\n    ];\n  } else if (tokenManagerKind === TokenManagerKind.Edition) {\n    return [\n      {\n        pubkey: findMintEditionId(mintId),\n        isSigner: false,\n        isWritable: false,\n      },\n      {\n        pubkey: METADATA_PROGRAM_ID,\n        isSigner: false,\n        isWritable: false,\n      },\n    ];\n  } else {\n    return [];\n  }\n};\n\nexport const getRemainingAccountsForUnissue = (\n  tokenManagerId: PublicKey,\n  tokenManagerData: TokenManagerData,\n  metadata: Metadata | null\n): AccountMeta[] => {\n  const remainingAccounts: AccountMeta[] = [];\n  if (\n    tokenManagerData.kind !== TokenManagerKind.Programmable &&\n    metadata?.tokenStandard === TokenStandard.ProgrammableNonFungible\n  ) {\n    remainingAccounts.push({\n      pubkey: findMintMetadataId(tokenManagerData.mint),\n      isSigner: false,\n      isWritable: false,\n    });\n  }\n  if (metadata?.programmableConfig?.ruleSet) {\n    remainingAccounts.push(\n      { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },\n      ...remainingAccountForProgrammable(\n        tokenManagerData.mint,\n        getAssociatedTokenAddressSync(\n          tokenManagerData.mint,\n          tokenManagerId,\n          true\n        ),\n        getAssociatedTokenAddressSync(\n          tokenManagerData.mint,\n          tokenManagerData.issuer,\n          true\n        ),\n        metadata?.programmableConfig?.ruleSet ?? undefined\n      )\n    );\n  }\n  return remainingAccounts;\n};\n\n/**\n * Convenience method to get remaining accounts for invalidation\n * NOTE: This ignores token account creation and assumes that is handled outside. Use withRemainingAccountsForInvalidate\n * to include token account creation in the current transaction\n * @param connection\n * @param mintId\n * @returns\n */\nexport const getRemainingAccountsForInvalidate = async (\n  connection: Connection,\n  wallet: Wallet,\n  mintId: PublicKey\n) => {\n  const tokenManagerId = findTokenManagerAddress(mintId);\n  const [tokenManagerInfo, metadataInfo] =\n    await connection.getMultipleAccountsInfo([\n      tokenManagerId,\n      findMintMetadataId(mintId),\n    ]);\n  if (!tokenManagerInfo) throw \"Token manager not found\";\n  const tokenManagerData = decodeIdlAccount<\n    \"tokenManager\",\n    CardinalTokenManager\n  >(tokenManagerInfo, \"tokenManager\", TOKEN_MANAGER_IDL);\n  if (!metadataInfo) throw \"Metadata not found\";\n  const metadata = Metadata.deserialize(metadataInfo.data)[0];\n\n  const receipientTokenAccount = await getAccount(\n    connection,\n    tokenManagerData.parsed.recipientTokenAccount\n  );\n\n  return await withRemainingAccountsForInvalidate(\n    new Transaction(),\n    connection,\n    wallet,\n    mintId,\n    { ...tokenManagerData, pubkey: tokenManagerId },\n    receipientTokenAccount.owner,\n    metadata\n  );\n};\n\nexport const withRemainingAccountsForInvalidate = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  mintId: PublicKey,\n  tokenManagerData: AccountData<TokenManagerData>,\n  recipientTokenAccountOwnerId: PublicKey,\n  metadata: Metadata | null\n): Promise<AccountMeta[]> => {\n  const remainingAccounts: AccountMeta[] = [];\n  if (\n    tokenManagerData.parsed.kind !== TokenManagerKind.Programmable &&\n    metadata?.tokenStandard === TokenStandard.ProgrammableNonFungible\n  ) {\n    // update kind\n    tokenManagerData.parsed.kind = TokenManagerKind.Programmable;\n    remainingAccounts.push({\n      pubkey: findMintMetadataId(mintId),\n      isSigner: false,\n      isWritable: false,\n    });\n  }\n\n  if (tokenManagerData.parsed.state === TokenManagerState.Claimed) {\n    remainingAccounts.push(\n      ...getRemainingAccountsForKind(mintId, tokenManagerData.parsed.kind)\n    );\n  }\n\n  if (\n    tokenManagerData.parsed.kind === TokenManagerKind.Programmable &&\n    (tokenManagerData.parsed.invalidationType === InvalidationType.Release ||\n      tokenManagerData.parsed.invalidationType === InvalidationType.Reissue)\n  ) {\n    const releaseAccounts = remainingAccountForProgrammableUnlockAndTransfer(\n      recipientTokenAccountOwnerId,\n      wallet.publicKey,\n      mintId,\n      tokenManagerData.parsed.recipientTokenAccount,\n      metadata?.programmableConfig?.ruleSet\n    );\n    remainingAccounts.push(...releaseAccounts);\n  } else {\n    const returnAccounts = await withRemainingAccountsForReturn(\n      transaction,\n      connection,\n      wallet,\n      tokenManagerData,\n      recipientTokenAccountOwnerId,\n      metadata?.programmableConfig?.ruleSet ?? undefined\n    );\n    remainingAccounts.push(...returnAccounts);\n  }\n  return remainingAccounts;\n};\n\nexport const withRemainingAccountsForReturn = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  tokenManagerData: AccountData<TokenManagerData>,\n  recipientTokenAccountOwnerId?: PublicKey,\n  rulesetId?: PublicKey\n): Promise<AccountMeta[]> => {\n  const {\n    issuer,\n    mint,\n    claimApprover,\n    recipientTokenAccount,\n    invalidationType,\n    kind,\n    receiptMint,\n    state,\n  } = tokenManagerData.parsed;\n  if (\n    invalidationType === InvalidationType.Vest &&\n    state === TokenManagerState.Issued\n  ) {\n    if (!claimApprover) throw \"Claim approver must be set\";\n    const claimApproverTokenAccountId =\n      await withFindOrInitAssociatedTokenAccount(\n        transaction,\n        connection,\n        mint,\n        claimApprover,\n        wallet.publicKey,\n        true\n      );\n    return [\n      {\n        pubkey: claimApproverTokenAccountId,\n        isSigner: false,\n        isWritable: true,\n      },\n    ];\n  } else if (\n    invalidationType === InvalidationType.Return ||\n    state === TokenManagerState.Issued\n  ) {\n    if (kind === TokenManagerKind.Programmable || rulesetId) {\n      if (!recipientTokenAccountOwnerId)\n        throw \"Recipient token account owner not specified\";\n      const remainingAccounts: AccountMeta[] = [];\n      let returnTokenAccountId;\n      if (receiptMint) {\n        const receiptMintLargestAccount =\n          await connection.getTokenLargestAccounts(receiptMint);\n\n        // get holder of receipt mint\n        const receiptTokenAccountId =\n          receiptMintLargestAccount.value[0]?.address;\n        if (!receiptTokenAccountId) throw new Error(\"No token accounts found\");\n        const receiptTokenAccount = await getAccount(\n          connection,\n          receiptTokenAccountId\n        );\n\n        // get ATA for this mint of receipt mint holder\n        returnTokenAccountId = await withFindOrInitAssociatedTokenAccount(\n          transaction,\n          connection,\n          mint,\n          receiptTokenAccount.owner,\n          wallet.publicKey,\n          true\n        );\n        remainingAccounts.push(\n          {\n            pubkey: returnTokenAccountId,\n            isSigner: false,\n            isWritable: true,\n          },\n          {\n            pubkey: receiptTokenAccount.owner,\n            isSigner: false,\n            isWritable: false,\n          },\n          {\n            pubkey: receiptTokenAccountId,\n            isSigner: false,\n            isWritable: true,\n          }\n        );\n      } else {\n        returnTokenAccountId = await withFindOrInitAssociatedTokenAccount(\n          transaction,\n          connection,\n          mint,\n          issuer,\n          wallet.publicKey,\n          true\n        );\n        remainingAccounts.push(\n          {\n            pubkey: returnTokenAccountId,\n            isSigner: false,\n            isWritable: true,\n          },\n          {\n            pubkey: issuer,\n            isSigner: false,\n            isWritable: false,\n          }\n        );\n      }\n      remainingAccounts.push(\n        {\n          pubkey: recipientTokenAccountOwnerId,\n          isSigner: false,\n          isWritable: false,\n        },\n        {\n          pubkey: wallet.publicKey,\n          isSigner: true,\n          isWritable: true,\n        },\n        {\n          pubkey: SystemProgram.programId,\n          isSigner: false,\n          isWritable: false,\n        },\n        {\n          pubkey: findTokenRecordId(\n            mint,\n            getAssociatedTokenAddressSync(mint, tokenManagerData.pubkey, true)\n          ),\n          isSigner: false,\n          isWritable: true,\n        },\n        ...remainingAccountForProgrammable(\n          mint,\n          recipientTokenAccount,\n          returnTokenAccountId,\n          rulesetId\n        )\n      );\n      return remainingAccounts;\n    } else {\n      if (receiptMint) {\n        const receiptMintLargestAccount =\n          await connection.getTokenLargestAccounts(receiptMint);\n\n        // get holder of receipt mint\n        const receiptTokenAccountId =\n          receiptMintLargestAccount.value[0]?.address;\n        if (!receiptTokenAccountId) throw new Error(\"No token accounts found\");\n        const receiptTokenAccount = await getAccount(\n          connection,\n          receiptTokenAccountId\n        );\n\n        // get ATA for this mint of receipt mint holder\n        const returnTokenAccountId = await withFindOrInitAssociatedTokenAccount(\n          transaction,\n          connection,\n          mint,\n          receiptTokenAccount.owner,\n          wallet.publicKey,\n          true\n        );\n        return [\n          {\n            pubkey: returnTokenAccountId,\n            isSigner: false,\n            isWritable: true,\n          },\n          {\n            pubkey: receiptTokenAccountId,\n            isSigner: false,\n            isWritable: true,\n          },\n        ];\n      } else {\n        const issuerTokenAccountId = await withFindOrInitAssociatedTokenAccount(\n          transaction,\n          connection,\n          mint,\n          issuer,\n          wallet.publicKey,\n          true\n        );\n        return [\n          {\n            pubkey: issuerTokenAccountId,\n            isSigner: false,\n            isWritable: true,\n          },\n        ];\n      }\n    }\n  } else {\n    return [];\n  }\n};\n\nexport const getRemainingAccountsForTransfer = (\n  transferAuthority: PublicKey | null,\n  tokenManagerId: PublicKey\n): AccountMeta[] => {\n  if (transferAuthority) {\n    const transferReceiptId = findTransferReceiptId(tokenManagerId);\n    return [\n      {\n        pubkey: transferReceiptId,\n        isSigner: false,\n        isWritable: true,\n      },\n    ];\n  } else {\n    return [];\n  }\n};\n\nexport const remainingAccountForProgrammable = (\n  mintId: PublicKey,\n  fromTokenAccountId: PublicKey,\n  toTokenAccountId: PublicKey,\n  rulesetId: PublicKey | undefined | null\n): AccountMeta[] => {\n  return [\n    {\n      pubkey: mintId,\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: findMintMetadataId(mintId),\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: findMintEditionId(mintId),\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: findTokenRecordId(mintId, fromTokenAccountId),\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: findTokenRecordId(mintId, toTokenAccountId),\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: SYSVAR_INSTRUCTIONS_PUBKEY,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: ASSOCIATED_TOKEN_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: TOKEN_AUTH_RULES_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: rulesetId ?? METADATA_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: METADATA_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n  ];\n};\n\nexport const remainingAccountForProgrammableUnlockAndTransfer = (\n  recipient: PublicKey,\n  payer: PublicKey,\n  mintId: PublicKey,\n  fromTokenAccountId: PublicKey,\n  rulesetId?: PublicKey | null\n): AccountMeta[] => {\n  return [\n    {\n      pubkey: recipient,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: payer,\n      isSigner: true,\n      isWritable: true,\n    },\n    {\n      pubkey: SystemProgram.programId,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: findTokenRecordId(\n        mintId,\n        getAssociatedTokenAddressSync(\n          mintId,\n          findTokenManagerAddress(mintId),\n          true\n        )\n      ),\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: mintId,\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: findMintMetadataId(mintId),\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: findMintEditionId(mintId),\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: findTokenRecordId(mintId, fromTokenAccountId),\n      isSigner: false,\n      isWritable: true,\n    },\n    {\n      pubkey: SYSVAR_INSTRUCTIONS_PUBKEY,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: ASSOCIATED_TOKEN_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: TOKEN_AUTH_RULES_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: rulesetId ?? METADATA_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n    {\n      pubkey: METADATA_PROGRAM_ID,\n      isSigner: false,\n      isWritable: false,\n    },\n  ];\n};\n\nexport const getRemainingAccountsForIssue = (\n  tokenManagerKind: TokenManagerKind,\n  mintId: PublicKey,\n  issuerTokenAccountId: PublicKey,\n  tokenManagerTokenAccountId: PublicKey,\n  rulesetId?: PublicKey\n): AccountMeta[] => {\n  if (tokenManagerKind === TokenManagerKind.Permissioned) {\n    return [\n      {\n        pubkey: CRANK_KEY,\n        isSigner: false,\n        isWritable: true,\n      },\n    ];\n  } else if (tokenManagerKind === TokenManagerKind.Programmable) {\n    return remainingAccountForProgrammable(\n      mintId,\n      issuerTokenAccountId,\n      tokenManagerTokenAccountId,\n      rulesetId\n    );\n  } else {\n    return [];\n  }\n};\n\nexport const getRemainingAccountsForClaim = (\n  tokenManagerData: AccountData<TokenManagerData>,\n  recipientTokenAccountId: PublicKey,\n  metadata: Metadata | null,\n  claimReceiptId?: PublicKey\n): AccountMeta[] => {\n  const remainingAccounts: AccountMeta[] = [];\n  if (\n    tokenManagerData.parsed.kind !== TokenManagerKind.Programmable &&\n    metadata?.tokenStandard === TokenStandard.ProgrammableNonFungible\n  ) {\n    // update kind\n    tokenManagerData.parsed.kind = TokenManagerKind.Programmable;\n    remainingAccounts.push({\n      pubkey: findMintMetadataId(tokenManagerData.parsed.mint),\n      isSigner: false,\n      isWritable: false,\n    });\n  }\n\n  if (\n    tokenManagerData.parsed.kind === TokenManagerKind.Managed ||\n    tokenManagerData.parsed.kind === TokenManagerKind.Permissioned\n  ) {\n    const mintManagerId = findMintManagerId(tokenManagerData.parsed.mint);\n    remainingAccounts.push({\n      pubkey: mintManagerId,\n      isSigner: false,\n      isWritable: true,\n    });\n  } else if (tokenManagerData.parsed.kind === TokenManagerKind.Edition) {\n    const editionId = findMintEditionId(tokenManagerData.parsed.mint);\n    remainingAccounts.push(\n      {\n        pubkey: editionId,\n        isSigner: false,\n        isWritable: false,\n      },\n      {\n        pubkey: METADATA_PROGRAM_ID,\n        isSigner: false,\n        isWritable: false,\n      }\n    );\n  } else if (tokenManagerData.parsed.kind === TokenManagerKind.Programmable) {\n    remainingAccounts.push(\n      ...remainingAccountForProgrammable(\n        tokenManagerData.parsed.mint,\n        getAssociatedTokenAddressSync(\n          tokenManagerData.parsed.mint,\n          tokenManagerData.pubkey,\n          true\n        ),\n        recipientTokenAccountId,\n        metadata?.programmableConfig?.ruleSet\n      )\n    );\n  }\n  if (claimReceiptId) {\n    remainingAccounts.push({\n      pubkey: claimReceiptId,\n      isSigner: false,\n      isWritable: true,\n    });\n  }\n  return remainingAccounts;\n};\n\nexport function findTokenRecordId(\n  mint: PublicKey,\n  token: PublicKey\n): PublicKey {\n  return PublicKey.findProgramAddressSync(\n    [\n      Buffer.from(\"metadata\"),\n      METADATA_PROGRAM_ID.toBuffer(),\n      mint.toBuffer(),\n      Buffer.from(\"token_record\"),\n      token.toBuffer(),\n    ],\n    METADATA_PROGRAM_ID\n  )[0];\n}\n\nexport const findRuleSetId = (authority: PublicKey, name: string) => {\n  return PublicKey.findProgramAddressSync(\n    [\n      Buffer.from(TOKEN_AUTH_RULESET_PREFIX),\n      authority.toBuffer(),\n      Buffer.from(name),\n    ],\n    TOKEN_AUTH_RULES_ID\n  )[0];\n};\n"]}